// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // directUrl = env("DIRECT_URL")
}

model Auth {
  id       String @id @default(uuid())
  username String @unique
  password String

  @@map("auth")
}

model Agenc {
  id         String   @id @default(uuid())
  nama       String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  sales Sales[]

  @@map("agenc")
}

model Wilayah {
  id   String @id @default(uuid())
  nama String @unique

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  stos               WilayahSto[]
  registrasi_indibiz RegistrasiIndibiz[]
  sales              Sales[]

  @@map("wilayah")
}

model Sto {
  id           String @id @default(uuid())
  name         String @unique
  abbreviation String

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  wilayahs WilayahSto[]
  sales    Sales[]

  @@map("sto")
}

model WilayahSto {
  id         String @id @default(uuid())
  wilayah_id String
  sto_id     String

  wilayah Wilayah @relation(fields: [wilayah_id], references: [id], onDelete: Cascade)
  sto     Sto     @relation(fields: [sto_id], references: [id], onDelete: Cascade)

  created_at DateTime @default(now())

  @@unique([wilayah_id, sto_id])
  @@map("wilayah_sto")
}

model Paket {
  id          String         @id @default(cuid())
  nama        String
  kode        String?        @unique
  kategori    KategoriPaket?
  ratio       Ratio?
  jenis_paket JenisPaket
  bandwidth   Int
  ont_type    TipeONT?
  harga       Decimal        @db.Decimal(10, 2)
  harga_psb   Decimal        @db.Decimal(10, 2)
  total       Decimal        @db.Decimal(10, 2)
  harga_coret Decimal?       @db.Decimal(10, 2)
  aktif       Boolean        @default(true)
  created_at  DateTime       @default(now())
  updated_at  DateTime       @updatedAt

  // Many-to-many implicit relation to Prodigi
  prodigis           Prodigi[]
  promo_pakets       PromoPaket[]
  registrasi_indibiz RegistrasiIndibiz[]

  @@index([kategori])
  @@index([bandwidth])
  @@index([jenis_paket])
  @@map("paket")
}

model Prodigi {
  id         String   @id @default(cuid())
  nama       String
  harga      Decimal  @db.Decimal(10, 2)
  aktif      Boolean  @default(true)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  // Many-to-many implicit relation to Paket
  pakets     Paket[]

  @@index([nama])
  @@map("prodigi")
}

model Promo {
  id                 String    @id @default(cuid())
  nama               String
  deskripsi          String?
  tipe_promo         TipePromo
  diskon_persen      Decimal?  @db.Decimal(5, 2)
  diskon_nominal     Decimal?  @db.Decimal(10, 2)
  psb_normal         Decimal?  @default(500.000) @db.Decimal(10, 2)
  psb_diskon_persen  Decimal?  @default(70) @db.Decimal(5, 2)
  psb_setelah_diskon Decimal?  @default(150.000) @db.Decimal(10, 2)
  tanggal_mulai      DateTime
  tanggal_selesai    DateTime
  aktif              Boolean   @default(true)
  is_global          Boolean   @default(false)
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt

  promo_pakets PromoPaket[]

  @@index([tanggal_mulai, tanggal_selesai])
  @@map("promo")
}

model PromoPaket {
  id          String   @id @default(cuid())
  promo_id    String
  paket_id    String
  harga_coret Decimal? @db.Decimal(10, 2)
  diskon_persen  Decimal? @db.Decimal(5, 2)
  diskon_nominal Decimal? @db.Decimal(10, 2)

  promo Promo @relation(fields: [promo_id], references: [id], onDelete: Cascade)
  paket Paket @relation(fields: [paket_id], references: [id], onDelete: Cascade)

  @@unique([promo_id, paket_id])
  @@map("promo_paket")
}

model Sales {
  id          String      @id @default(uuid())
  nama        String      @unique
  kode_sales  String?
  email       String?     @unique
  status      StatusSales
  agency_id   String
  wilayah_id  String?
  sto_id      String?
  kat_umur_sa DateTime    @db.Date()
  tgl_reg     DateTime    @db.Date()

  wilayah Wilayah? @relation(fields: [wilayah_id], references: [id])
  agency  Agenc    @relation(fields: [agency_id], references: [id])
  sto     Sto?     @relation(fields: [sto_id], references: [id])

  registrasi_indibiz RegistrasiIndibiz[]

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("sales")
}

model RegistrasiIndibiz {
  id          String    @id @default(uuid())
  nama        String
  wilayah_id  String
  paket_id    String
  sales_id    String
  no_hp_1     String
  no_hp_2     String?
  kordinat    String?
  alamat      String
  nama_pic    String
  ttl_pic     String
  no_ktp      String
  email       String
  nomer_ao    String?
  status      StatusAo? 
  keterangan  String?
  foto_ktp    String
  foto_selfie String
  bukti_usaha String
  bukti_niwp  String
  foto_lokasi String?

  wilayah Wilayah @relation(fields: [wilayah_id], references: [id])
  paket   Paket   @relation(fields: [paket_id], references: [id])
  sales   Sales   @relation(fields: [sales_id], references: [id])

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@map("registrasi_indibiz")
}

enum KategoriPaket {
  HSI_BISNIS_1_1 // HSI Bisnis ratio 1:1
  HSI_BISNIS_1_2 // HSI Bisnis ratio 1:2
  HSI_BASIC_1_2 // HSI Basic ratio 1:2
  RETENSI_1_1 // Paket Retensi ratio 1:1
  RETENSI_1_2 // Paket Retensi ratio 1:2
  AKUISISI_1_1 // Paket Akuisisi ratio 1:1
  AKUISISI_1_2 // Paket Akuisisi ratio 1:2
}

enum JenisPaket {
  INET_ONLY // Internet Only (tanpa add-on)
  INET_PRODIGI // Internet + Prodigi (NETMONX, OCA, dll)
  INET_BASIC // Internet Basic + CCTV Antarez Easy
  VOICE // Paket Voice/Telepon
  USEETV // Paket TV
}

enum Ratio {
  RATIO_1_1 // 1:1 (Dedicated)
  RATIO_1_2 // 1:2 (Up to)
}

enum TipeONT {
  STANDARD // ONT Standard
  DUAL_BAND // ONT Dual Band
  PREMIUM // ONT Premium
}

enum TipePromo {
  DISKON_PERSEN // Diskon persentase (misal: 10% dari harga)
  DISKON_NOMINAL // Diskon nominal tetap (misal: potongan 50rb)
  DISKON_PSB // Diskon khusus untuk biaya PSB
  COMBO // Kombinasi diskon paket + PSB
}

enum StatusSales {
  ACTIVE
  DELETED
}

enum KategoriDatel {
  HERO
  NON_HERO
}

enum SubArea {
  INNER
  OUTER
}

enum StatusAo {
  PS
  CANCEL
  KENDALA
  REVOKE
  QC1
  PI
  FALLOUT
  WFM_UNSC
  QC2_FCC
  PAPERLESS
  SURVER
  DECLINE_FCC
  PT3_WAITING_AKTIVASI
  FOLLOWUP_TO_COMPLETE
}
